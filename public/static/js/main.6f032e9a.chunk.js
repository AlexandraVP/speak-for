(this["webpackJsonpmeow-frontend"]=this["webpackJsonpmeow-frontend"]||[]).push([[0],[,,,,,,,,,,function(e,t,a){e.exports=a(24)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(9),o=a.n(r),c=(a(15),a(1)),i=a.n(c),u=a(6),l=a(2),m=a(3),p=a(5),g=a(4),h=(a(17),a(7)),d=(a(18),a(19),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).containerRef=n.a.createRef(),e.scrollHeight=null,e.getOldMessages=function(){0===e.containerRef.current.scrollTop&&e.props.getOldMessages()},e}return Object(m.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this.containerRef.current;e.messages[0]&&e.messages[0].index>this.props.messages[0].index?t.scrollTop=t.scrollHeight-this.scrollHeight:(null===this.scrollHeight||this.scrollHeight-t.offsetHeight-t.scrollTop<50)&&(t.scrollTop=t.scrollHeight),this.scrollHeight=t.scrollHeight}},{key:"render",value:function(){var e=localStorage.getItem("username");return n.a.createElement("div",{ref:this.containerRef,className:"messagesContainer",onWheel:this.getOldMessages},this.props.messages.map((function(t,a){return n.a.createElement("div",{key:a,className:e===t.author?"right":""},n.a.createElement("div",{className:"message-group"},n.a.createElement("span",{className:"author"},t.author),n.a.createElement("p",{className:"message"},t.text)))})))}}]),a}(s.Component)),f=(a(20),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={message:""},e.sendMessage=function(t){t.nativeEvent&&t.nativeEvent.preventDefault(),0!==e.state.message.trim().length&&(e.props.sendMessage(e.state.message),e.setState({message:""}))},e.updateMessage=function(t){e.setState({message:t.target.value})},e.keyUpHandler=function(t){13===t.keyCode&&t.shiftKey&&e.sendMessage(t)},e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){document.addEventListener("keyup",this.keyUpHandler)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.keyUpHandler)}},{key:"render",value:function(){return n.a.createElement("form",{className:"messageForm",onSubmit:this.sendMessage},n.a.createElement("textarea",{className:"messageInput",onChange:this.updateMessage,value:this.state.message,maxLength:"450"}),n.a.createElement("input",{className:"sendButton",type:"submit",value:""}))}}]),a}(s.Component)),v=(a(21),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).logout=function(){fetch("/users/logout",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8","X-Auth-Token":localStorage.getItem("x-auth-token")}}).then((function(){localStorage.removeItem("x-auth-token"),localStorage.removeItem("username"),e.props.logout()}))},e}return Object(m.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"header"},n.a.createElement("div",{className:"title-name"},"MEOW chat"),n.a.createElement("div",{className:"logout",onClick:this.logout},"Logout"))}}]),a}(s.Component)),w=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={messages:[]},e.appendMessages=function(t){e.setState({messages:[].concat(Object(h.a)(e.state.messages),Object(h.a)(t))})},e.unshiftMessages=function(t){e.setState({messages:[].concat(Object(h.a)(t),Object(h.a)(e.state.messages))})},e.getOldMessages=Object(u.a)(i.a.mark((function t(){var a,s,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((a=e.state.messages).length<20||e.oldMessagesRequestPending)){t.next=3;break}return t.abrupt("return");case 3:return e.oldMessagesRequestPending=!0,s=a[0].date,t.next=7,fetch("/messages/before?until=".concat(s,"&count=20"),{headers:{"X-Auth-Token":localStorage.getItem("x-auth-token")}});case 7:return n=t.sent,t.next=10,n.json();case 10:(r=t.sent).length&&e.unshiftMessages(r),setTimeout((function(){e.oldMessagesRequestPending=!1}),500);case 13:case"end":return t.stop()}}),t)}))),e.updateMessages=Object(u.a)(i.a.mark((function t(){var a,s,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.state.messages,s=a[a.length-1].date,t.next=4,fetch("/messages/after?since=".concat(s),{headers:{"X-Auth-Token":localStorage.getItem("x-auth-token")}});case 4:return n=t.sent,t.next=7,n.json();case 7:(r=t.sent).length&&e.appendMessages(r),e.timeout=setTimeout(e.updateMessages,500);case 10:case"end":return t.stop()}}),t)}))),e.sendMessage=function(e){fetch("/messages",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8","X-Auth-Token":localStorage.getItem("x-auth-token")},body:JSON.stringify({text:e})})},e.init=Object(u.a)(i.a.mark((function t(){var a,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/messages/new?count=20",{headers:{"X-Auth-Token":localStorage.getItem("x-auth-token")}});case 2:return a=t.sent,t.next=5,a.json();case 5:s=t.sent,e.setState({messages:s}),e.timeout=setTimeout(e.updateMessages,500);case 8:case"end":return t.stop()}}),t)}))),e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.init()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeout)}},{key:"render",value:function(){return n.a.createElement("div",{className:"container"},n.a.createElement(v,{logout:this.props.logout}),n.a.createElement("div",{className:"main"},n.a.createElement("div",{className:"addInfo"}),n.a.createElement("div",{className:"chat"},n.a.createElement(d,{messages:this.state.messages,getOldMessages:this.getOldMessages}),n.a.createElement(f,{sendMessage:this.sendMessage}))))}}]),a}(s.Component),E=(a(22),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={username:"",authError:!1,password:""},e.login=function(){var t=Object(u.a)(i.a.mark((function t(a){var s,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.nativeEvent.preventDefault(),s=e.state.username.toLowerCase().trim(),n=e.state.password,s){t.next=5;break}return t.abrupt("return");case 5:e.props.login(s,n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.updateUsername=function(t){e.setState({username:t.target.value,authError:!1})},e.updatePassword=function(t){e.setState({password:t.target.value,authError:!1})},e}return Object(m.a)(a,[{key:"render",value:function(){return n.a.createElement("form",{className:"form",onSubmit:this.login},n.a.createElement("h2",{className:"title"},"Welcome"),n.a.createElement("div",{className:"logo"}),n.a.createElement("input",{className:"input",type:"text",placeholder:"Username",onChange:this.updateUsername,value:this.state.username}),!!this.state.authError&&n.a.createElement("div",{className:"error-container"},n.a.createElement("span",{className:"error"},"username is taken")),n.a.createElement("input",{className:"password",type:"password",name:"password",placeholder:"Password",onChange:this.updatePassword,value:this.state.password}),n.a.createElement("input",{className:"submit",type:"submit",value:"LOGIN"}),n.a.createElement("div",{className:"sign-form"},n.a.createElement("span",{className:"not-account"},"Don't have an account? "),n.a.createElement("span",{className:"sign",onClick:this.props.switchForm},"Sign up"),n.a.createElement("span",{className:"footer"},"\ud83d\udc3e")))}}]),a}(s.Component)),b=(a(23),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={username:"",password:"",repeatPassword:"",error:""},e.register=Object(u.a)(i.a.mark((function t(){var a,s,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.state.username.trim().toLowerCase()){t.next=5;break}e.setState({error:"Enter Username"}),t.next=17;break;case 5:if(e.state.password){t.next=9;break}e.setState({error:"Enter Password"}),t.next=17;break;case 9:if(e.state.password===e.state.repeatPassword){t.next=13;break}e.setState({error:"Passwords don`t match"}),t.next=17;break;case 13:return t.next=15,fetch("users/register",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({username:a,password:e.state.password})});case 15:(s=t.sent).status>400?e.setState({error:s.status}):(n=e.state.username.toLowerCase().trim(),e.state.password,e.props.login(n,e.state.password));case 17:case"end":return t.stop()}}),t)}))),e.updateUsername=function(t){var a=t.target.value;e.setState({username:a,error:""})},e.updatePassword=function(t){var a=t.target.value;e.setState({password:a,error:""})},e.updateRepeatPassword=function(t){var a=t.target.value;e.setState({repeatPassword:a,error:""})},e}return Object(m.a)(a,[{key:"render",value:function(){return n.a.createElement("form",{className:"register-form"},n.a.createElement("h2",{className:"title"},"Sign up"),n.a.createElement("div",{className:"logo"}),n.a.createElement("input",{className:"register-input",type:"text",placeholder:"Username",value:this.state.username,onChange:this.updateUsername}),n.a.createElement("input",{className:"register-password",type:"password",placeholder:"Password",value:this.state.password,onChange:this.updatePassword}),n.a.createElement("input",{className:"repeat-password",type:"password",placeholder:"Confirm Password",value:this.state.repeatPassword,onChange:this.updateRepeatPassword}),!!this.state.error&&n.a.createElement("div",{className:"error-container"},n.a.createElement("span",{className:"error"},this.state.error)),n.a.createElement("div",{className:"get-start",onClick:this.register},n.a.createElement("span",null,"Get started")),n.a.createElement("div",{className:"have-account"},n.a.createElement("span",{className:"already-have"},"Already have an accout?"),n.a.createElement("span",{className:"log-in",onClick:this.props.switchForm}," Log in")))}}]),a}(s.Component)),y=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(l.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={isAuthorised:!!localStorage.getItem("x-auth-token"),needRegistration:!1},e.login=function(){var t=Object(u.a)(i.a.mark((function t(a,s){var n,r,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/users/login",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({username:a,password:s})});case 2:return 403===(n=t.sent).status&&e.setState({authError:!0}),t.next=6,n.json();case 6:r=t.sent,o=r.token,localStorage.setItem("username",a),localStorage.setItem("x-auth-token",o),e.setState({isAuthorised:!0});case 11:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.logout=function(){e.setState({isAuthorised:!1})},e.toggleSingForm=function(){e.setState({needRegistration:!e.state.needRegistration})},e}return Object(m.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"layout"},this.state.isAuthorised?n.a.createElement(w,{logout:this.logout}):this.state.needRegistration?n.a.createElement(E,{login:this.login,switchForm:this.toggleSingForm}):n.a.createElement(b,{switchForm:this.toggleSingForm,login:this.login}))}}]),a}(s.Component);o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(y,null)),document.getElementById("root"))}],[[10,1,2]]]);
//# sourceMappingURL=main.6f032e9a.chunk.js.map